{% extends "base.html" %}

{% block title %}Settings - FastRep{% endblock %}

{% block content %}
<div class="settings-page">
    <div class="card">
        <h2>‚öôÔ∏è Settings</h2>

        <div class="settings-section">
            <h3>Appearance</h3>
            <p class="info-text">
                Choose your preferred theme.
            </p>
            <div class="theme-toggle">
                <button onclick="setTheme('light')" class="btn btn-secondary">‚òÄÔ∏è Light</button>
                <button onclick="setTheme('dark')" class="btn btn-secondary">üåô Dark</button>
                <button onclick="setTheme('system')" class="btn btn-secondary">üíª System</button>
            </div>
            <p id="current-theme-text" class="info-text">Current theme: System</p>
        </div>
        
        <div class="settings-section">
            <h3>Database Management</h3>
            <p class="info-text">
                ‚ö†Ô∏è Warning: Clearing the database will permanently delete all log entries. This action cannot be undone.
            </p>
            
            <button onclick="clearDatabase()" class="btn btn-danger">Clear All Data</button>
        </div>
        
        <div class="settings-section">
            <h3>Database Location</h3>
            <p class="info-text">
                Your logs are stored in: <code>~/.fastrep/fastrep.db</code>
            </p>
        </div>
        
        <div class="settings-section">
            <h3>CLI Access</h3>
            <p class="info-text">
                You can also manage your logs using the command line:
            </p>
            <pre><code>fastrep log -p "Project Name" -d "Description"
fastrep view --mode weekly
fastrep list
fastrep delete --id 1</code></pre>
        </div>
        
        <div class="settings-section">
            <h3>About</h3>
            <p class="info-text">
                FastRep v1.0.6<br>
                A simple work log manager for tracking daily activities and generating reports.<br>
                <a href="https://github.com/hissain/fastrep" target="_blank">GitHub Repository</a>
            </p>
        </div>
    </div>
    
    <div class="card">
        <a href="{{ url_for('index') }}" class="btn btn-secondary">‚Üê Back to Home</a>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
// Theme settings
function updateThemeText() {
    const theme = localStorage.getItem('theme') || 'system';
    const text = theme.charAt(0).toUpperCase() + theme.slice(1);
    document.getElementById('current-theme-text').textContent = `Current theme: ${text}`;
}

function setTheme(theme) {
    if (theme === 'system') {
        localStorage.removeItem('theme');
        delete document.documentElement.dataset.theme;
        // Re-apply system preference check if needed, but removing dataset.theme usually falls back to default CSS
        // However, if we want to support system preference in CSS, we need media queries or JS detection.
        // My CSS uses [data-theme="dark"], so removing it reverts to light.
        // To support system dark mode properly, I should check window.matchMedia.
        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
             document.documentElement.dataset.theme = 'dark';
        }
    } else {
        localStorage.setItem('theme', theme);
        document.documentElement.dataset.theme = theme;
    }
    updateThemeText();
}

// Initialize text
updateThemeText();

async function clearDatabase() {
    const confirmed = confirm(
        '‚ö†Ô∏è Are you absolutely sure you want to delete ALL log entries?\n\n' +
        'This action cannot be undone!'
    );
    
    if (!confirmed) {
        return;
    }
    
    const doubleCheck = confirm(
        'This is your last chance!\n\n' +
        'Click OK to permanently delete all data.'
    );
    
    if (!doubleCheck) {
        return;
    }
    
    try {
        const response = await fetch('/clear_all', {
            method: 'POST'
        });
        
        const result = await response.json();
        
        if (result.success) {
            alert('‚úì All data has been cleared successfully.');
            window.location.href = '/';
        } else {
            alert('‚úó Error clearing database');
        }
    } catch (error) {
        alert('‚úó Error clearing database');
    }
}
</script>
{% endblock %}
